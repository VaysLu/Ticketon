<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>
        Состав КПИ
    </title>
    <meta name="description" content="Page Titile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, minimal-ui">
    <!-- Call App Mode on ios devices -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Remove Tap Highlight on Windows Phone IE -->
    <meta name="msapplication-tap-highlight" content="no">
    <!-- base css -->
    <link rel="stylesheet" media="screen, print" href="css/vendors.bundle.css">
    <link rel="stylesheet" media="screen, print" href="css/app.bundle.css">
    <!-- Place favicon.ico in the root directory -->
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/site.webmanifest">
    <!-- <link rel="stylesheet" media="screen, print" href="css/your_styles.css"> -->

    <!-- page related CSS below -->
    <link rel="stylesheet" media="screen, print" href="css/formplugins/select2/select2.bundle.css">

    <link rel="stylesheet" href="css/formplugins/flatpick/flatpick.css">
    <link rel="stylesheet" href="css/formplugins/flatpick/style.css">
</head>

<body class="mod-bg-1 ">
    <h1 class="visually-hidden">Состав КПИ FREEDOM Ticketon</h1>

    <script>
        'use strict';

        var classHolder = document.getElementsByTagName("BODY")[0],

            themeSettings = (localStorage.getItem('themeSettings')) ? JSON.parse(localStorage.getItem('themeSettings')) :
                {},
            themeURL = themeSettings.themeURL || '',
            themeOptions = themeSettings.themeOptions || '';

        if (themeSettings.themeOptions) {
            classHolder.className = themeSettings.themeOptions;
        }
        if (themeSettings.themeURL && !document.getElementById('mytheme')) {
            var cssfile = document.createElement('link');
            cssfile.id = 'mytheme';
            cssfile.rel = 'stylesheet';
            cssfile.href = themeURL;
            document.getElementsByTagName('head')[0].appendChild(cssfile);
        }
        var saveSettings = function () {
            themeSettings.themeOptions = String(classHolder.className).split(/[^\w-]+/).filter(function (item) {
                return /^(nav|header|mod|display)-/i.test(item);
            }).join(' ');
            if (document.getElementById('mytheme')) {
                themeSettings.themeURL = document.getElementById('mytheme').getAttribute("href");
            };
            localStorage.setItem('themeSettings', JSON.stringify(themeSettings));
        }
        var resetSettings = function () {
            localStorage.setItem("themeSettings", "");
        }

    </script>

    <!-- BEGIN Page Wrapper -->
    <div class="page-wrapper">
        <div class="page-inner">
            <!-- BEGIN Left Aside -->
            <aside class="page-sidebar">
                <div class="page-logo page-logo--white">
                    <a href="index.html"
                        class="page-logo-link press-scale-down d-flex align-items-center position-relative"
                        aria-label="Ссылка на главную страницу">
                        <img src="img/F.png" alt="FREEDOM Ticketon" aria-roledescription="logo"
                            aria-label="Ссылка на главную страницу">
                    </a>
                </div>

                <!-- BEGIN PRIMARY NAVIGATION -->
                <nav id="js-primary-nav" class="primary-nav" role="navigation">
                    <div class="nav-filter">
                        <div class="position-relative">
                            <input type="text" id="nav_filter_input" placeholder="Фильтр меню" class="form-control"
                                tabindex="0">
                            <button type="button" class="btn-primary btn-search-close js-waves-off"
                                aria-label="Кнопка открытия поиска" data-action="toggle" data-class="list-filter-active"
                                data-target=".page-sidebar">
                                <i class="fal fa-chevron-up"></i>
                            </button>
                        </div>
                    </div>
                    <div class="info-card">
                        <img src="img/avatars/avatar-admin.png" class="profile-image rounded-circle"
                            alt="Dr. Codex Lantern">
                        <div class="info-card-text">
                            <a href="#" class="d-flex align-items-center text-white">
                                <span class="text-truncate text-truncate-sm d-inline-block">
                                    Байдаулетов Асхат
                                </span>
                            </a>
                            <span class="d-inline-block text-truncate text-truncate-sm">Администратор</span>
                        </div>
                        <img src="img/card-backgrounds/cover-2-lg.png" class="cover" alt="cover">
                        <button type="button" class="pull-trigger-btn" data-action="toggle"
                            data-class="list-filter-active" data-target=".page-sidebar" data-focus="nav_filter_input"
                            aria-label="Кнопка закрытия поиска">
                            <i class="fal fa-angle-down"></i>
                        </button>
                    </div>
                    <ul id="js-nav-menu" class="nav-menu">
                        <!-- <li>
                            <a href="#" data-filter-tags="управление сетью">
                                <i class="fal fa-globe"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Управление сетью</span>
                            </a>
                        </li> -->
                        <!-- <li>
                            <a href="#" data-filter-tags="записи">
                                <i class="fal fa-edit"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Записи</span>
                            </a>
                        </li> -->
                        <!-- <li>
                            <a href="#" data-filter-tags="аналитика">
                                <i class="fal fa-chart-pie"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Аналитика</span>
                            </a>
                        </li> -->


                        <li>
                            <!-- <a href="summary_table-admin.html" data-filter-tags="сводная таблица">
                                <i class="fal fa-th-list"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Сводная таблица</span>
                            </a> -->
                            <a class="nav-menu__btn waves-effect waves-themed" href="#"
                                data-filter-tags="сводная таблица" aria-expanded="false" aria-controls="list">
                                <i class="fal fa-th-list"></i>
                                <span class="nav-link-text">Сводная таблица</span>
                            </a>
                            <ul class="nav-menu__list">
                                <li>
                                    <a href="summary_table-admin.html" data-filter-tags="версия администратора">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_analytics_dashboard">Администратор</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="summary_table-employee.html" data-filter-tags="версия сотрудника">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_analytics_dashboard">Сотрудник</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li>
                            <a class="nav-menu__btn waves-effect waves-themed" href="#" data-filter-tags="сотрудники"
                                aria-expanded="false" aria-controls="list">
                                <i class="fal fa-solid fa-user-secret"></i>
                                <span class="nav-link-text">Сотрудники</span>
                            </a>
                            <ul class="nav-menu__list">
                                <li>
                                    <a href="add_an_employee.html" data-filter-tags="Добавить сотрудника">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_analytics_dashboard">Добавить
                                            сотрудника</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="add_data.html" data-filter-tags="Добавить данные">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_marketing_dashboard">Добавить данные</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="edit_data.html" data-filter-tags="Изменить данные">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_introduction">Изменить данные</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="dismiss.html" data-filter-tags="Уволить сотрудника">
                                        <i class="point"></i>
                                        <span class="nav-link-text" data-i18n="nav.application_intel_privacy">Уволить
                                            сотрудника</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="edit_password.html" data-filter-tags="Изменить пароль">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_build_notes">Изменить пароль</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="task_scheduler.html" class="active" data-filter-tags="планировщик задач">
                                <i class="fal fa-table"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Планировщик задач</span>
                            </a>
                        </li>
                        <li>
                            <a class="nav-menu__btn waves-effect waves-themed" href="#" data-filter-tags="отделы"
                                aria-expanded="false" aria-controls="list">
                                <i class="fal fa-tag"></i>
                                <span class="nav-link-text">Отделы</span>
                            </a>
                            <ul class="nav-menu__list">
                                <li>
                                    <a href="add_department.html" data-filter-tags="Добавить отдел">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_analytics_dashboard">Добавить отдел</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="edit_department.html" data-filter-tags="Изменить отдел">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_marketing_dashboard">Изменить отдел</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="rem_department.html" data-filter-tags="Удалить отдел">
                                        <i class="point"></i>
                                        <span class="nav-link-text"
                                            data-i18n="nav.application_intel_introduction">Удалить отдел</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="link_department.html" data-filter-tags="Привязать к отделу">
                                        <i class="point"></i>
                                        <span class="nav-link-text" data-i18n="nav.application_intel_privacy">Привязать
                                            к отделу</span>
                                    </a>
                                </li>
                            </ul>
                        </li>


                        <!-- <li>
                            <a href="#"data-filter-tags="клиент">
                                <i class="fal fa-solid fa-users"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Клиенты</span>
                            </a>
                        </li> -->
                        <!-- <li>
                            <a href="#"data-filter-tags="услуги">
                                <i class="fal fa-solid fa-clipboard"></i>
                                <span class="nav-link-text"
                                    data-i18n="nav.application_intel_analytics_dashboard">Услуги</span>
                            </a>
                        </li> -->
                    </ul>
                    <!-- <div class="filter-message js-filter-message bg-success-600"></div> -->
                </nav>
                <!-- END PRIMARY NAVIGATION -->
            </aside>
            <!-- END Left Aside -->
            <div class="page-content-wrapper">
                <header class="page-header" role="banner">
                    <div class="header-inner">
                        <div class="page-logo">
                            <a href="index.html"
                                class="page-logo-link press-scale-down d-flex align-items-center position-relative"
                                data-toggle="modal" data-target="#modal-shortcut">
                                <img src="img/F_white.png" alt="FREEDOM Ticketon" aria-roledescription="logo"
                                    aria-label="Ссылка на главную страницу">
                                <!-- <span class="page-logo-text mr-1">SmartAdmin WebApp</span> -->
                                <span
                                    class="position-absolute text-white opacity-50 small pos-top pos-right mr-2 mt-n2"></span>
                                <i class="fal fa-angle-down d-inline-block ml-1 fs-lg color-primary-300"></i>
                            </a>
                        </div>

                        <!-- Начало кнопки скрытия сайдбара -->
                        <div class="hidden-md-down dropdown-icon-menu position-relative">
                            <button type="button" class="header-btn btn js-waves-off" data-action="toggle"
                                data-class="nav-function-minify" title="Minify Navigation"
                                aria-label="Кнопка скрытия сайдбара">
                                <i class="ni ni-minify-nav"></i>
                            </button>
                        </div>
                        <!-- Конец кнопки скрытия сайдбара -->

                        <div class="hidden-lg-up">
                            <button href="#" class="header-btn btn press-scale-down" data-action="toggle"
                                data-class="mobile-nav-on" aria-label="Кнопка бургер-меню">
                                <i class="ni ni-menu"></i>
                            </button>
                        </div>

                        <div class="ml-auto d-flex">
                            <div id="clickbox" class="ml-auto__block">
                                <button type="button" data-toggle="dropdown" title="drlantern@gotbootstrap.com"
                                    class="header-icon d-flex align-items-center justify-content-center ml-2"
                                    aria-label="Кнопка открытия меню пользователя">
                                    <img src="img/avatars/avatar-admin.png" class="profile-image rounded-circle"
                                        alt="Dr. Codex Lantern">
                                </button>
                                <div class="dropdown-menu dropdown-menu-animated dropdown-lg">
                                    <div class="dropdown-header bg-trans-gradient d-flex flex-row py-4 rounded-top">
                                        <div class="d-flex flex-row align-items-center mt-1 mb-1 color-white">
                                            <span class="mr-2">
                                                <img src="img/avatars/avatar-admin.png"
                                                    class="rounded-circle profile-image" alt="Dr. Codex Lantern">
                                            </span>
                                            <div class="info-card-text">
                                                <div class="fs-lg text-truncate text-truncate-lg">Байдаулетов Асхат
                                                </div>
                                                <span
                                                    class="text-truncate text-truncate-md opacity-80">Администратор</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dropdown-divider m-0"></div>
                                    <a href="#" class="dropdown-item" data-action="app-reset">
                                        <span data-i18n="drpdwn.reset_layout">Задачи на месяц</span>
                                    </a>
                                    <a href="#" class="dropdown-item" data-toggle="modal"
                                        data-target=".js-modal-settings">
                                        <span data-i18n="drpdwn.settings">Сводная таблица</span>
                                    </a>
                                    <div class="dropdown-divider m-0"></div>
                                    <a class="dropdown-item fw-500 pt-3 pb-3" href="page_login.html">
                                        <span data-i18n="drpdwn.page-logout">Выйти</span>
                                        <span class="float-right fw-n">baidauletov</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <main id="js-page-content" role="main" class="page-content">
                    <ol class="breadcrumb page-breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">FREEDOM Ticketon</a></li>
                        <li class="breadcrumb-item active">Состав КПИ</li>
                    </ol>
                    <div class="subheader">
                        <h2 class="subheader-title">
                            <i class="fal fa-th-list"></i> Состав КПИ
                        </h2>
                        <form action="" class="subheader-block" id="composition-kpi-form" method="GET">
                            <select class="select2 form-control w-100" name="employee" id="department-select"
                                onchange="formAjax('')">
                                <option value="my-composition" selected>Мой состав</option>
                                <option value="all-department">Все сотрудники</option>
                                <optgroup label="Руководство">
                                    <option value="1">ФИО-1</option>
                                    <option value="2">ФИО-2</option>
                                    <option value="3">ФИО-3</option>
                                    <option value="4">ФИО-4</option>
                                </optgroup>
                                <optgroup label="Финансы">
                                    <option value="1">ФИО-1</option>
                                    <option value="2">ФИО-2</option>
                                    <option value="3">ФИО-3</option>
                                    <option value="4">ФИО-4</option>
                                </optgroup>

                            </select>
                            <input type="text" class="date" name="date">
                        </form>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div id="panel-1" class="panel">
                                <div class="panel-hdr">
                                    <h2 class="justify-content-center panel-hdr__date">
                                        Май 2024
                                    </h2>
                                    <div class="panel-toolbar">
                                        <!-- <button class="save-date o-btn" type="button"
                                                onclick="saveData()">Сохранить</button> -->

                                        <button class="btn btn-panel" data-action="panel-fullscreen"
                                            data-toggle="tooltip" data-offset="0,10"
                                            data-original-title="На весь экран"></button>
                                    </div>
                                </div>
                                <div class="panel-container show overflow">
                                    <div class="panel-content">
                                        <div class="panel-tag panel-tag__error">
                                            Процентное соотношение расставленно не верно
                                        </div>
                                        <div class="frame-wrap table-responsive-lg">
                                            <table class="table m-0 table-bordered table-striped task-scheduler">
                                                <thead>
                                                    <tr class="text-center th-green fs-1">
                                                        <th class="role-name th-green-department">Ф.И.О.</th>
                                                        <th>Показатели KPI</th>
                                                        <th>Доли (%)</th>
                                                        <th>Доли (тенге)</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="table-employee-data">
                                                    <tr>
                                                        <td rowspan="4" class="br-1 data-name vert-center">Иванов</td>
                                                        <td>Личные производственные показатели</td>
                                                        <td class="text-center info vert-center">
                                                            <div>
                                                                <span class="info__text planned-time">65</span>
                                                                <input type="number"
                                                                    class="info__input input-department">
                                                            </div>
                                                        </td>
                                                        <td class="text-center">0</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Успех компании</td>
                                                        <td class="text-center info vert-center">
                                                            <div>
                                                                <span class="info__text planned-time">15</span>
                                                                <input type="number"
                                                                    class="info__input input-department">
                                                            </div>
                                                        </td>
                                                        <td class="text-center">0</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Оценка руководителя</td>
                                                        <td class="text-center info vert-center">
                                                            <div>
                                                                <span class="info__text planned-time">10</span>
                                                                <input type="number"
                                                                    class="info__input input-department">
                                                            </div>
                                                        </td>
                                                        <td class="text-center">0</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Оценка внешних клиентов</td>
                                                        <td class="text-center info vert-center">
                                                            <div>
                                                                <span class="info__text planned-time">10</span>
                                                                <input type="number"
                                                                    class="info__input input-department">
                                                            </div>
                                                        </td>
                                                        <td class="text-center">0</td>
                                                    </tr>
                                                    <tr class="tr-gray text-center">
                                                        <td class="br-1">Итого</td>
                                                        <td></td>
                                                        <td class="text-center all-percent">100</td>
                                                        <td class="text-center">0</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>

                <div class="page-content-overlay" data-action="toggle" data-class="mobile-nav-on"></div>


            </div>
        </div>
    </div>
    <!--------------------- Скрипты шаблона ----------------------->
    <script src="js/vendors.bundle.js"></script>
    <!--------------------- Скрипты шаблона ----------------------->
    <script src="js/app.bundle.js"></script>

    <!--------- Подключение плагина Select2 ------------->
    <script src="js/formplugins/select2/select2.bundle.js"></script>

    <!--------------- Подключение плагина Flatpickr ----------------->
    <script type="text/javascript" src="js/formplugins/flatpick/flatpick.js"></script>

    <!--------------- Русификатор плагина Flatpickr ----------------->
    <script type="text/javascript" src="js/formplugins/flatpick/ru.js"></script>

    <!--------------- Виджет отображения месяцев в плагине Flatpickr ----------------->
    <script type="text/javascript" src="js/formplugins/flatpick/flatpick-monthYear.js"></script>

    <!-- ---------------- Скрипт работы со страницей --------------------
    <script type="text/javascript" src="js/scripts/task_scheduler.js"></script> -->

    <!-- ----------------    Инициализация плагина Select2    -------------->
    <script>
        $(document).ready(function () {
            $(function () {
                $('.select2').select2();
            });
        });
    </script>

    <!---------------        Скрипт календаря по месяцам ----------------------->
    <script>
        const dateUTC = new Date();
        const yearUTC = dateUTC.getFullYear();
        const monthUTC = dateUTC.getMonth() + 1;


        flatpickr('.date', {
            plugins: [
                new monthSelectPlugin({
                    shorthand: true,
                    dateFormat: "m.y",
                    altFormat: "F Y",
                    theme: "white"
                })
            ],
            // mode: 'range',
            "locale": "ru",
            disableMobile: "true",
            onClose: function (selectedDates, dateStr, instance) {

                // Получаем первую выбранную дату
                let firstDate = selectedDates[0];
                // Получаем месяц первой даты
                let firstMonth = firstDate.getMonth() + 1;
                // Получаем год первой даты
                let firstYear = firstDate.getFullYear();

                let firstSelect = `${compilateMonth(firstMonth)}-${firstYear}`;


                formAjax(firstSelect);

            }
        });

        // // Функция компиляции месяца ()
        function compilateMonth(month) {
            if (month === 10 || month === 11 || month === 12) {
                return month;
            } else {
                return `0${month}`;
            }
        }


    </script>

    <!-- ----------------  Отправка формы с датой ----------------->
    <script>
        function formAjax(result) {
            if (result.length > 0)
                $("input[name='date']").val(result);
            $("#composition-kpi-form").submit();
        }
    </script>

    <!-- ----------------      Скрипт на внесение изменений в таблице -------------->
    <script>
        const infoEl = document.querySelectorAll('.info');

        infoEl.forEach((item) => {
            item.addEventListener('click', () => {
                const spanEl = item.querySelector('.info__text');
                const inputEl = item.querySelector('.info__input');

                const text = spanEl.textContent;
                inputEl.value = text;

                if (inputEl.classList.contains('input-department')) {
                    item.classList.add('info-active');
                    inputEl.classList.remove('input-department');
                    spanEl.classList.add('input-department');
                    inputEl.focus();
                }

                inputBlur();
            })
        })

        function inputBlur() {

            const inputEl = document.querySelector('.info__input:focus');
            const infoEl = document.querySelector('.info.info-active');

            inputEl.onblur = function () {

                const spanEl = document.querySelector('.info__text.input-department');

                spanEl.innerText = inputEl.value;
                infoEl.classList.remove('info-active');
                spanEl.classList.remove('input-department');
                inputEl.classList.add('input-department');
                check();
            }
        }

        //************  Подсчёт процентов ----------------->
        function check() {
            const panel = document.querySelector('.panel-content');
            const percents = document.querySelectorAll('.info__text');
            const allPercent = document.querySelector('.all-percent');
            const sumArr = [];

            percents.forEach(percent => {
                sumArr.push(Number(percent.textContent));
            });

            const sum = sumArr.reduce((acc, percent) => {
                return acc = percent + acc;
            }, 0);

            allPercent.textContent = sum;

            if (sum < 100 || sum > 100) {
                panel.classList.add('panel-content--error');
            } else {
                if (panel.classList.contains('panel-content--error')) {
                    panel.classList.remove('panel-content--error');
                }
                console.log('Процентное соотношение верно');
            }
        }
    </script>
</body>

</html>